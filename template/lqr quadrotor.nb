(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     14539,        371]
NotebookOptionsPosition[     13888,        352]
NotebookOutlinePosition[     14260,        368]
CellTagsIndexPosition[     14217,        365]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "y", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x", "[", "t", "]"}], ",", 
     RowBox[{"y", "[", "t", "]"}], ",", 
     RowBox[{"z", "[", "t", "]"}], ",", 
     RowBox[{"\[Phi]x", "[", "t", "]"}], ",", 
     RowBox[{"\[Phi]y", "[", "t", "]"}], ",", 
     RowBox[{"\[Phi]z", "[", "t", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"p1", "[", "t", "]"}], ",", 
     RowBox[{"p2", "[", "t", "]"}], ",", 
     RowBox[{"p3", "[", "t", "]"}], ",", 
     RowBox[{"p4", "[", "t", "]"}], ",", 
     RowBox[{"p5", "[", "t", "]"}], ",", 
     RowBox[{"p6", "[", "t", "]"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"M", "=", 
    RowBox[{"DiagonalMatrix", "@", 
     RowBox[{"{", 
      RowBox[{
      "mb", ",", "mb", ",", "mb", ",", "ixx", ",", "iyy", ",", "izz"}], 
      "}"}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "Dynamics", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"R", "=", 
   RowBox[{
    RowBox[{"RotationMatrix", "[", 
     RowBox[{
      RowBox[{"\[Phi]z", "[", "t", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
    RowBox[{"RotationMatrix", "[", 
     RowBox[{
      RowBox[{"\[Phi]y", "[", "t", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
    RowBox[{"RotationMatrix", "[", 
     RowBox[{
      RowBox[{"\[Phi]x", "[", "t", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ydot", "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Inverse", "[", "M", "]"}], ".", "p"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"T", " ", 
       RowBox[{"R", ".", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Tau]1", ",", "\[Tau]2", ",", "\[Tau]3"}], "}"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"y", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"q", ",", "p"}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"equil", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Thread", "[", 
      RowBox[{"q", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"T", "\[Rule]", "T0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"params", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"mb", "\[Rule]", "100"}], ",", 
     RowBox[{"ixx", "\[Rule]", "3333"}], ",", 
     RowBox[{"iyy", "\[Rule]", "3333"}], ",", 
     RowBox[{"izz", "\[Rule]", "1000"}], ",", 
     RowBox[{"T0", "\[Rule]", "0.98"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ydot", ",", 
       RowBox[{"{", 
        RowBox[{"Join", "[", 
         RowBox[{"q", ",", "p"}], "]"}], "}"}]}], "]"}], "/.", "equil"}], "/.",
     "params"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"B", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ydot", ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"T", ",", "\[Tau]1", ",", "\[Tau]2", ",", "\[Tau]3"}], "}"}],
         "}"}]}], "]"}], "/.", "equil"}], "/.", "params"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Q", "=", 
   RowBox[{"DiagonalMatrix", "@", 
    RowBox[{"{", 
     RowBox[{
     "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
      "1", ",", "1", ",", "0.1", ",", "0.1", ",", "0.1"}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Rr", "=", 
    RowBox[{"DiagonalMatrix", "@", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"A", "/.", "params"}], "//", "N"}], "//", 
     RowBox[{
      RowBox[{"MatrixForm", "\[IndentingNewLine]", "B"}], "/.", "params"}]}], 
    "//", "MatrixForm"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{"S", "=", 
    RowBox[{
     RowBox[{"RiccatiSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"A", ",", "B"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Q", ",", "Rr"}], "}"}]}], "]"}], "//", "Chop"}]}], ")"}], "//",
   "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"A", "\[Transpose]"}], ".", "S"}], "+", 
    RowBox[{"S", ".", "A"}], "-", 
    RowBox[{"S", ".", "B", ".", 
     RowBox[{"Inverse", "[", "Rr", "]"}], ".", 
     RowBox[{"B", "\[Transpose]"}], ".", "S"}], "+", "Q"}], ")"}], "//", 
  "Chop"}], "\[IndentingNewLine]", 
 RowBox[{"S", "//", "CForm"}]}], "Input",
 CellChangeTimes->{{3.808232571784111*^9, 3.808232652877288*^9}, {
  3.8082327215596733`*^9, 3.808232838088228*^9}, {3.8082328768405933`*^9, 
  3.8082333377628574`*^9}, {3.808233439371255*^9, 3.808233476213971*^9}, {
  3.8082336554154825`*^9, 3.808233703315215*^9}, {3.80823381779243*^9, 
  3.8082339053034725`*^9}, {3.808234289539769*^9, 3.808234294476081*^9}, {
  3.808234325733638*^9, 3.8082343523365655`*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"69f80987-4c85-4d83-a780-fa1d231ef52d"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"148.63323830090116`", "0", "0", "0", "1227.1305940665584`", "0", 
      "60.459197644011745`", "0", "0", "0", "0.9999999997776448`", "0"},
     {"0", "148.63323829662758`", "0", 
      RowBox[{"-", "1227.130592601852`"}], "0", "2.78655025145515`*^-8", "0", 
      "60.45919761098977`", "0", 
      RowBox[{"-", "1.0000000000976244`"}], "0", "0"},
     {"0", "0", "100.99504938362075`", "0", "0", "0", "0", "0", "1.`", "0", 
      "0", "0"},
     {"0", 
      RowBox[{"-", "1227.130592578972`"}], "0", "67852.6374376914`", "0", 
      "8.025985844048187`*^-7", "0", 
      RowBox[{"-", "1790.593937328141`"}], "0", "59.25001364938505`", "0", 
      "8.003670131039207`*^-9"},
     {"1227.1305926378923`", "0", "0", "0", "67852.63756961962`", "0", 
      "1790.5939392762568`", "0", "0", "0", "59.25001366836082`", "0"},
     {"0", "0", "0", "0", "0", "319.37438786323156`", "0", "0", "0", "0", "0",
       "1.0000000001617644`"},
     {"60.459197634119256`", "0", "0", "0", "1790.593940128918`", "0", 
      "77.34072255317956`", "0", "0", "0", "1.4863323826787476`", "0"},
     {"0", "60.45919760722755`", "0", 
      RowBox[{"-", "1790.5939375232454`"}], "0", "1.341900666357133`*^-8", 
      "0", "77.34072249089046`", "0", 
      RowBox[{"-", "1.486332382820918`"}], "0", "0"},
     {"0", "0", "0.9999999999999662`", "0", "0", "0", "0", "0", 
      "1.0099504938362078`", "0", "0", "0"},
     {"0", 
      RowBox[{"-", "1.0000000000850744`"}], "0", "59.250013648479246`", "0", 
      RowBox[{"-", "3.7758848664609356`*^-10"}], "0", 
      RowBox[{"-", "1.486332382600924`"}], "0", "0.36817599534229906`", "0", 
      "0"},
     {"1.0000000001838987`", "0", "0", "0", "59.250013701244946`", "0", 
      "1.4863323832950708`", "0", "0", "0", "0.3681759956855034`", "0"},
     {"0", "0", "0", "0", "0", "0.9999999997637417`", "0", "0", "0", "0", "0",
       "0.31937438779944344`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.8082333273657064`*^9, 3.8082333380953503`*^9}, {
   3.8082334440709457`*^9, 3.808233476719989*^9}, 3.808233704283249*^9, {
   3.8082338181781855`*^9, 3.808233905638332*^9}, 3.8082342949685555`*^9, {
   3.8082343261595807`*^9, 3.808234352638386*^9}},
 CellLabel->
  "Out[58]//MatrixForm=",ExpressionUUID->"c828c698-2139-4fe0-9a29-\
4cd3ab529c1a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "3.0611104762101604`*^-9", ",", 
     "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "2.1591195498160687`*^-10", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{"-", "1.826987450215256`*^-10"}], ",", "0", ",", 
     RowBox[{"-", "4.506482298438641`*^-9"}], ",", "0", ",", 
     RowBox[{"-", "3.775884866829554`*^-10"}], ",", "0", ",", 
     "2.2024959633881735`*^-10", ",", "0", ",", "0", ",", "0", ",", "0"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0",
      ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{"-", "6.572875577148807`*^-10"}], ",", "0", ",", 
     RowBox[{"-", "4.4287389755481854`*^-8"}], ",", "0", ",", 
     "1.2178263281835148`*^-9", ",", "0", ",", 
     RowBox[{"-", "1.0234602498826462`*^-8"}], ",", "0", ",", 
     RowBox[{"-", "2.3382185077025497`*^-10"}], ",", "0", ",", 
     RowBox[{"-", "1.7535686638445196`*^-9"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.1800445892949938`*^-9", ",", "0", ",", "0", ",", "0", ",", 
     "1.6774220057413913`*^-7", ",", "0", ",", "2.534628507078196`*^-9", ",", 
     "0", ",", "0", ",", "0", ",", "1.1887987483305551`*^-8", ",", "0"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0",
      ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "4.461711000658397`*^-9", ",", 
     "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "3.146202187664926`*^-10", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "1.2249046221768367`*^-9", ",", "0", ",", 
     RowBox[{"-", "2.825669699369176`*^-10"}], ",", "0", ",", 
     "2.8704927323985885`*^-10", ",", "0", ",", "0", ",", "0", ",", "0"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0",
      ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", 
     RowBox[{"-", "1.159210505363717`*^-10"}], ",", "0", ",", 
     "3.798226725877322`*^-10", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.6230368705147953`*^-10"}], ",", "0", ",", "0", ",", "0", 
     ",", "3.848383833826574`*^-10", ",", "0", ",", 
     RowBox[{"-", "1.6405654092166433`*^-10"}], ",", "0", ",", "0", ",", "0", 
     ",", 
     RowBox[{"-", "2.3177335051194348`*^-10"}], ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "1.3924300601431128`*^-10", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     "0", ",", "4.1765622904588184`*^-10"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8082333273657064`*^9, 3.8082333380953503`*^9}, {
   3.8082334440709457`*^9, 3.808233476719989*^9}, 3.808233704283249*^9, {
   3.8082338181781855`*^9, 3.808233905638332*^9}, 3.8082342949685555`*^9, {
   3.8082343261595807`*^9, 3.80823435266964*^9}},
 CellLabel->"Out[59]=",ExpressionUUID->"6e97b20d-ce88-4471-b061-37371d963cf6"],

Cell["\<\
List(List(148.63323830090116,0,0,0,1227.1305940665584,0,
    60.459197644011745,0,0,0,0.9999999997776448,0),
   List(0,148.63323829662758,0,-1227.130592601852,0,2.78655025145515e-8,
    0,60.45919761098977,0,-1.0000000000976244,0,0),
   List(0,0,100.99504938362075,0,0,0,0,0,1.,0,0,0),
   List(0,-1227.130592578972,0,67852.6374376914,0,8.025985844048187e-7,
    0,-1790.593937328141,0,59.25001364938505,0,8.003670131039207e-9),
   List(1227.1305926378923,0,0,0,67852.63756961962,0,1790.5939392762568,
    0,0,0,59.25001366836082,0),
   List(0,0,0,0,0,319.37438786323156,0,0,0,0,0,1.0000000001617644),
   List(60.459197634119256,0,0,0,1790.593940128918,0,77.34072255317956,
    0,0,0,1.4863323826787476,0),
   List(0,60.45919760722755,0,-1790.5939375232454,0,
    1.341900666357133e-8,0,77.34072249089046,0,-1.486332382820918,0,0),
   List(0,0,0.9999999999999662,0,0,0,0,0,1.0099504938362078,0,0,0),
   List(0,-1.0000000000850744,0,59.250013648479246,0,
    -3.7758848664609356e-10,0,-1.486332382600924,0,0.36817599534229906,
    0,0),List(1.0000000001838987,0,0,0,59.250013701244946,0,
    1.4863323832950708,0,0,0,0.3681759956855034,0),
   List(0,0,0,0,0,0.9999999997637417,0,0,0,0,0,0.31937438779944344))\
\>", "Output",
 CellChangeTimes->{{3.8082333273657064`*^9, 3.8082333380953503`*^9}, {
   3.8082334440709457`*^9, 3.808233476719989*^9}, 3.808233704283249*^9, {
   3.8082338181781855`*^9, 3.808233905638332*^9}, 3.8082342949685555`*^9, {
   3.8082343261595807`*^9, 3.8082343526852636`*^9}},
 CellLabel->
  "Out[60]//CForm=",ExpressionUUID->"78713382-7287-4dab-8764-a5d93804bde6"]
}, Open  ]]
},
WindowSize->{958, 988},
WindowMargins->{{Automatic, -7}, {Automatic, 0}},
Magnification:>1.25 Inherited,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 5591, 167, 516, "Input",ExpressionUUID->"69f80987-4c85-4d83-a780-fa1d231ef52d"],
Cell[6174, 191, 2706, 54, 297, "Output",ExpressionUUID->"c828c698-2139-4fe0-9a29-4cd3ab529c1a"],
Cell[8883, 247, 3391, 73, 321, "Output",ExpressionUUID->"6e97b20d-ce88-4471-b061-37371d963cf6"],
Cell[12277, 322, 1595, 27, 442, "Output",ExpressionUUID->"78713382-7287-4dab-8764-a5d93804bde6"]
}, Open  ]]
}
]
*)

